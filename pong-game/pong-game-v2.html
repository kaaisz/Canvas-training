<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Pong Game - Pt.2</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!-- <link rel="stylesheet" type="text/css" media="screen" href="main.css" /> -->
    <!-- <script src="main.js"></script> -->
    <style>
        html, body{
            margin:0;
            padding:0;
            overflow:hidden;/*to unscrollable this page*/
            width:100%;
            height:100%;
        }
        body{
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            display:flex;
            align-items:center;
            justify-content: center;
        }
        main{
            margin-right:20px;
        }
        th{text-align: left} 
        #game-canvas{
            background:black;
        }
    </style>
</head>
<body>
    <main>
    <h2>Motion Like Pong</h2>
    <h3>How to define logic</h3>
    <p>In this case, defined each elements below</p>
    <table>
        <tr>
            <th>Wall</th>
            <td> : </td>
            <td>outside of frame on Canvas</td>
        </tr>
        <tr>
            <th>If part of puck was outside of wall</th>
            <td> : </td>
            <td>cross(should be bounce back)</td>
        </tr>
        <tr>
            <th>If puck was crossing with any side of walls</th>
            <td> : </td>
            <td>flip velocity to change direction of puck</td>
        </tr>
    </table>
    <p>Eg) In case of that puck has bounced back on the lower side of the wall:<br>
    Solution : you can flip the direction vertically by multiplying <code>velocityY</code>> to <code>-1</code> (velocityY * -1)</p>
    </main>
    <canvas id="game-canvas"></canvas>
    <script>
        //setup canvas
        var boardWidth = 512;
        var boardHeight = 256;
        var canvas; //for global variable to refer from everywhere
        var context;//to activate functions of canvas

        //setup time for calc elapsed time
        var counter = 0;
        var lastTime;//variable for store the time for last frame

        //Add instance of Puck
        var puck;


        //Add Puck object
        function Puck(x, y){//x and y is an initialised position
            var self = this;//Add variable named 'self' to refer instance of Puck, instead of 'this'
            self.radius = 5;//set size of radius as 5
            self.x = x;
            self.y = y;

            //set variable for making movement
            self.velocityX = 0.4;
            self.velocityY = 0.3;

            //define function to update location of Puck
            //* update is receiving dt as a parameter
            self.update = function(dt){
                //calc coodinate after it moved by multiplying elapsedTimeFromFrame * velocity
                self.x += self.velocityX * dt;//for x-coordinate
                self.y += self.velocityY * dt;
            }
            
            //add function to render
            self.draw = function(context){
                context.fillStyle = "white";
                context.beginPath();//add new path on canvas
                context.arc(self.x, self.y, self.radius, 0, 2*Math.PI);//add circle
                context.fill();//render
            }
        }

        //this is for initialise each variable and add event handler.
        function init(){
            //set width and height for canvas
            canvas = document.getElementById("game-canvas");
            canvas.width = boardWidth;
            canvas.height = boardHeight;
            //add instance of Puck to make initialise point in this function
            puck = new Puck(100, 100);
            //to preparing to render, get 2d context by using this below
            context = canvas.getContext("2d");

            lastTime = performance.now();//store current time(as ms by using performance.now()) 
        }
        
        //this is for updating condition of this game
        function update(dt){
            counter += 1;
            console.log(counter);//counter will increase when update has been invoked 
            puck.update(dt);//invoke puck.update() here by passing dt to parameter
        }

        //this is for rendering condition on canvas
        function render(dt){
            // erase trace of Puck by initialization with using clearRect(startingPointX,startingPointY,value.width, value.height);
            context.clearRect(0, 0, canvas.width, canvas.height);

            // context.fillStyle = "white";//set the fillStyle to white
            // context.beginPath();
            // context.arc(100, 100, 9, 0, 2*Math.PI);
            // context.fill();
            //draw circle by using the technique like above with puck.draw()
            puck.draw(context); 
        }

        //this is for invoking update() and render()
        function main(){
            var now = performance.now();
            var dt = now - lastTime;
            var maxFrameTime = 1000 / 60;

            if(dt > maxFrameTime){
                dt = maxFrameTime;
            }
            
            /*
            pass dt(time difference between last frame and current time) 
            as a parameter for both update() and render() to update conditions 
            of each frames
            */
            update(dt);
            render(dt);
            //add current time to update the time last frame has done
            lastTime = now;

            requestAnimationFrame(main);
            /*
            by using this function to invoke itself, 
            you can make loop to invoke main() per 16ms when main has been executed.
            * when you want to pass function itself as a parameter, use function name as parameter(in case of "main()" must be name as "main").
            * requestAnimationFrame is useful for game or animation due to be able to stop/intrrupt loop when it's not needed.
            */
        }

        //execute funciton
        init();//initialise game
        main();//starting loop
    </script>
</body>
</html>